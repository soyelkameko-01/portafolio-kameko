
import React, { useState, useRef, useEffect } from 'react';

interface HeroProps {
  imageUrl: string;
  setImageUrl: (url: string) => void;
  opacity: number;
  setOpacity: (val: number) => void;
}

const Hero: React.FC<HeroProps> = ({ imageUrl, setImageUrl, opacity, setOpacity }) => {
  const [isEditing, setIsEditing] = useState(false);
  const [tempUrl, setTempUrl] = useState(imageUrl);
  const fileInputRef = useRef<HTMLInputElement>(null);

  // Al cargar, intentamos recuperar la configuraci√≥n guardada
  useEffect(() => {
    const savedImg = localStorage.getItem('kameko_hero_img');
    const savedOpacity = localStorage.getItem('kameko_hero_opacity');
    if (savedImg) setImageUrl(savedImg);
    if (savedOpacity) setOpacity(parseFloat(savedOpacity));
  }, []);

  const handleSave = () => {
    setImageUrl(tempUrl);
    localStorage.setItem('kameko_hero_img', tempUrl);
    localStorage.setItem('kameko_hero_opacity', opacity.toString());
    setIsEditing(false);
  };

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        const base64String = reader.result as string;
        setImageUrl(base64String);
        setTempUrl(base64String);
        localStorage.setItem('kameko_hero_img', base64String);
        localStorage.setItem('kameko_hero_opacity', opacity.toString());
        setIsEditing(false);
      };
      reader.readAsDataURL(file);
    }
  };

  const handleReset = () => {
    if (window.confirm('¬øRestablecer portada original?')) {
      const defaultImg = 'https://images.unsplash.com/photo-1618336753974-aae8e04506aa?q=80&w=2070&auto=format&fit=crop';
      setImageUrl(defaultImg);
      setOpacity(0.5);
      localStorage.removeItem('kameko_hero_img');
      localStorage.removeItem('kameko_hero_opacity');
      setIsEditing(false);
    }
  };

  return (
    <section className="relative min-h-screen flex flex-col items-center justify-center overflow-hidden">
      {/* Principal Hero Image with Mask/Overlay */}
      <div className="absolute inset-0 z-0 overflow-hidden">
        <img 
          src={imageUrl} 
          alt="Hero Background" 
          style={{ opacity: opacity }}
          className="w-full h-full object-cover scale-105 blur-[1px] animate-in zoom-in duration-[2500ms] transition-opacity duration-300"
        />
        <div className="absolute inset-0 bg-gradient-to-b from-[#030303] via-transparent to-[#030303]" />
      </div>

      <div className="relative z-10 text-center px-6">
        <span className="inline-block px-5 py-1.5 rounded-full border border-white/5 bg-white/5 text-[9px] font-bold tracking-[0.5em] uppercase text-pink-500 mb-10 animate-in fade-in slide-in-from-bottom-4 duration-1000">
          Fotograf√≠a Cosplay Cinem√°tica
        </span>
        
        <h1 className="text-6xl sm:text-7xl md:text-[10rem] font-inter-black leading-[0.8] tracking-tighter mb-10 animate-in zoom-in duration-1000">
          <span className="block text-white">EL KAMEKO</span>
          <span className="block bg-gradient-to-r from-pink-500 via-purple-400 to-cyan-400 bg-clip-text text-transparent opacity-90">STUDIO</span>
        </h1>

        <div className="flex flex-col md:flex-row items-center justify-center gap-8 mt-16 animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-500">
          <p className="max-w-xs text-neutral-400 text-xs md:text-sm leading-relaxed font-medium uppercase tracking-widest opacity-60">
            Capturando la esencia del personaje a trav√©s de luz y t√©cnica cinematogr√°fica.
          </p>
          <div className="h-px w-12 bg-white/10 hidden md:block" />
          <div className="flex gap-10">
             <div className="text-left">
               <div className="text-2xl font-bold font-syncopate text-white">150+</div>
               <div className="text-[8px] text-neutral-500 uppercase tracking-widest font-bold">Sesiones</div>
             </div>
             <div className="text-left">
               <div className="text-2xl font-bold font-syncopate text-white">PX-9</div>
               <div className="text-[8px] text-neutral-500 uppercase tracking-widest font-bold">Lente Pro</div>
             </div>
          </div>
        </div>

        {/* Edit Button UI */}
        <div className="mt-20 flex flex-col items-center gap-4">
          {!isEditing ? (
            <button 
              onClick={() => setIsEditing(true)}
              className="px-8 py-3 glass rounded-full text-[8px] font-bold uppercase tracking-[0.3em] text-neutral-500 hover:text-white hover:bg-white/10 transition-all group flex items-center gap-3 border border-white/5"
            >
              <span className="text-xs group-hover:rotate-180 transition-transform duration-700">‚öô</span> Personalizar Portada
            </button>
          ) : (
            <div className="glass p-8 rounded-[2.5rem] flex flex-col gap-6 animate-in slide-in-from-top-4 duration-500 w-full max-w-md shadow-2xl border-white/10">
              <div className="flex flex-col gap-3 text-left">
                <div className="flex justify-between items-center px-1">
                  <label className="text-[9px] uppercase tracking-widest text-neutral-500 font-bold">Opacidad Fondo</label>
                  <span className="text-[9px] font-inter-black text-pink-500">{Math.round(opacity * 100)}%</span>
                </div>
                <input 
                  type="range" min="0" max="1" step="0.01" value={opacity} 
                  onChange={(e) => setOpacity(parseFloat(e.target.value))}
                  className="w-full accent-pink-500 bg-white/5 h-1 rounded-full appearance-none cursor-pointer"
                />
              </div>

              <div className="h-px bg-white/5 w-full" />

              <div className="flex flex-col gap-3 text-left">
                <label className="text-[9px] uppercase tracking-widest text-neutral-500 font-bold px-1">Fuente de Imagen (URL)</label>
                <input 
                  type="text" placeholder="Pega un enlace de imagen..." value={tempUrl}
                  onChange={(e) => setTempUrl(e.target.value)}
                  className="w-full bg-black/40 border border-white/5 rounded-xl px-4 py-3 text-[10px] text-white outline-none focus:border-pink-500 transition-all"
                />
                <div className="flex gap-2">
                  <button 
                    onClick={handleSave}
                    className="flex-1 bg-white text-black py-3 rounded-xl text-[9px] font-bold uppercase tracking-widest hover:bg-pink-500 hover:text-white transition-all"
                  >
                    Guardar Cambios
                  </button>
                  <button 
                    onClick={handleReset}
                    className="px-4 border border-white/10 rounded-xl text-neutral-500 hover:text-red-500 transition-colors text-[9px] font-bold uppercase"
                  >
                    Reset
                  </button>
                </div>
              </div>

              <div className="relative py-2 flex items-center justify-center">
                 <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-white/5"></div></div>
                 <span className="relative px-4 bg-[#030303] text-[8px] text-neutral-600 font-bold uppercase tracking-widest">O</span>
              </div>

              <div className="flex flex-col gap-4">
                <input type="file" accept="image/*" className="hidden" ref={fileInputRef} onChange={handleFileUpload} />
                <button 
                  onClick={() => fileInputRef.current?.click()}
                  className="w-full py-4 border border-white/10 rounded-xl text-[9px] font-bold uppercase tracking-widest hover:bg-white/5 transition-all flex items-center justify-center gap-2"
                >
                  üìÅ Subir Imagen Local
                </button>
                <button onClick={() => setIsEditing(false)} className="text-neutral-600 hover:text-white text-[8px] uppercase tracking-widest font-bold transition-colors">Cerrar Editor</button>
              </div>
            </div>
          )}
        </div>
      </div>
    </section>
  );
};

export default Hero;